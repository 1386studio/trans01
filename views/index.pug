extends layout

block content
  div(style="position:relative;line-height: 2rem;font-size: 1rem;")
    span= selected.name
    span(style="position:absolute;top:0;right:0;line-height:0")
      a#conflict-edit-btn.layui-btn.layui-btn-danger.layui-btn-sm(href="#") 编辑属性
      a#conflict-edit-btn2.layui-btn.layui-btn-danger.layui-btn-sm(href="#") 编辑简介
  table#test.layui-hide
block layer
  form#conflict-editor-prop.layui-form(action='', style="display:none")
    .layui-form-item
      .layui-input-block
        button.layui-btn(lay-submit='', lay-filter='demo1') 立即提交
        button.layui-btn.layui-btn-primary(type='reset') 重置
  #conflict-editor-intro(style="display:none")
    #conflict-editor-intro-content
block conflict-list
  each v,i in conflicts
    li.layui-nav-item(class=(v._id == selected._id) ? "layui-this" : "")
      a(href= `/conflicts/${v._id}`)= v.name
block script
  script.
    layui.use('table', function(){
      var table = layui.table;
      table.render({
        elem: '#test'
        ,url:'/alerts'
        ,cellMinWidth: 80
        ,cols: [[
            {field:'_id', width:80, title: 'ID', sort: true}
            ,{field:'title', width:80, title: '用户名'}
        ]]
      });
    });
    layui.use('layer', function(){
      var layer = layui.layer;
      $('#conflict-edit-btn').on('click', function(){
        var index = layer.open({
          type: 1,
          content: $('#conflict-editor-prop'),
          area: ['520px', '295px'],
          //- maxmin: true,
          shade: 0
        });
        //- layer.full(index);
      });
      $('#conflict-edit-btn2').on('click', function(){
        $("#conflict-editor-intro").append("<div id=\"test-editormd\"></div>");
        var testEditor = {};
        var index = layer.open({
          type: 1,
          content: $('#conflict-editor-intro'),
          area: ['520px', '395px'],
          //- maxmin: true,
          shade: 0,
          success: function() {
            testEditor = editormd("test-editormd", {
              width: "100%",
              height: 740,
              path : '/editor.md/lib/',
              //- theme : "light",
              //- previewTheme : "light",
              //- editorTheme : "pastel-on-dark",
              markdown : '#{selected.intro}',
              codeFold : true,
              //syncScrolling : false,
              saveHTMLToTextarea : true,    // 保存 HTML 到 Textarea
              searchReplace : true,
              //watch : false,                // 关闭实时预览
              htmlDecode : "style,script,iframe|on*",            // 开启 HTML 标签解析，为了安全性，默认不开启    
              //toolbar  : false,             //关闭工具栏
              //previewCodeHighlight : false, // 关闭预览 HTML 的代码块高亮，默认开启
              emoji : true,
              taskList : true,
              tocm            : true,         // Using [TOCM]
              tex : true,                   // 开启科学公式TeX语言支持，默认关闭
              flowChart : true,             // 开启流程图支持，默认关闭
              sequenceDiagram : true,       // 开启时序/序列图支持，默认关闭,
              //dialogLockScreen : false,   // 设置弹出层对话框不锁屏，全局通用，默认为true
              //dialogShowMask : false,     // 设置弹出层对话框显示透明遮罩层，全局通用，默认为true
              //dialogDraggable : false,    // 设置弹出层对话框不可拖动，全局通用，默认为true
              //dialogMaskOpacity : 0.4,    // 设置透明遮罩层的透明度，全局通用，默认值为0.1
              //dialogMaskBgColor : "#000", // 设置透明遮罩层的背景颜色，全局通用，默认为#fff
              imageUpload : true,
              imageFormats : ["jpg", "jpeg", "gif", "png", "bmp", "webp"],
              imageUploadURL : "/upload",
              onload : function() {
                this.fullscreen();
              }
            }); 
          },
          cancel: function(){
            console.log(testEditor.getMarkdown());
            testEditor.editor.remove();
          }
        });
        layer.full(index);
      });
    });

